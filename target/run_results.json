{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.1", "generated_at": "2024-11-05T18:51:29.862570Z", "invocation_id": "49c41901-553d-49f4-913d-55edebeb76ec", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.594542Z", "completed_at": "2024-11-05T18:51:29.608534Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.609960Z", "completed_at": "2024-11-05T18:51:29.716165Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.12673211097717285, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_customers", "compiled": true, "compiled_code": "SELECT\n  \n  TRY_CAST(customer_id AS INTEGER)\n AS customer_id,\n  \nCONCAT(UPPER(SUBSTRING(TRIM(first_name), 1, 1)), LOWER(SUBSTRING(TRIM(first_name), 2)))\n AS first_name,\n  \nCONCAT(UPPER(SUBSTRING(TRIM(last_name), 1, 1)), LOWER(SUBSTRING(TRIM(last_name), 2)))\n AS last_name,\n  LOWER(TRIM(email)) AS email,\n  \n  TRY_CAST(created_at AS TIMESTAMP)\n AS created_at\nFROM \"jaffle_shop\".\"main\".\"raw_customers\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_customers\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.602209Z", "completed_at": "2024-11-05T18:51:29.609074Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.625230Z", "completed_at": "2024-11-05T18:51:29.717124Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.12773990631103516, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_order_details", "compiled": true, "compiled_code": "SELECT\n  CAST(order_id AS INTEGER) AS order_id,\n  CAST(product_id AS INTEGER) AS product_id,\n  CAST(quantity AS INTEGER) AS quantity,\n  CAST(unit_price AS DECIMAL(10,2)) AS unit_price,\n  CAST(line_total AS DECIMAL(10,2)) AS line_total\nFROM \"jaffle_shop\".\"main\".\"raw_order_details\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_order_details\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.601050Z", "completed_at": "2024-11-05T18:51:29.609211Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.626699Z", "completed_at": "2024-11-05T18:51:29.717758Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.12860608100891113, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_inventory_transactions", "compiled": true, "compiled_code": "SELECT\n  CAST(transaction_id AS INTEGER) AS transaction_id,\n  CAST(product_id AS INTEGER) AS product_id,\n  CAST(quantity_change AS INTEGER) AS quantity_change,\n  CAST(transaction_date AS TIMESTAMP) AS transaction_date,\n  CONCAT(UPPER(SUBSTRING(TRIM(reason), 1, 1)), LOWER(SUBSTRING(TRIM(reason), 2))) AS reason\nFROM \"jaffle_shop\".\"main\".\"raw_inventory_transactions\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_inventory_transactions\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.604932Z", "completed_at": "2024-11-05T18:51:29.609581Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.629558Z", "completed_at": "2024-11-05T18:51:29.718235Z"}], "thread_id": "Thread-6 (worker)", "execution_time": 0.128248929977417, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_products", "compiled": true, "compiled_code": "SELECT\n  \n  TRY_CAST(product_id AS INTEGER)\n AS product_id,\n  \nCONCAT(UPPER(SUBSTRING(TRIM(product_name), 1, 1)), LOWER(SUBSTRING(TRIM(product_name), 2)))\n AS product_name,\n  \nCONCAT(UPPER(SUBSTRING(TRIM(category), 1, 1)), LOWER(SUBSTRING(TRIM(category), 2)))\n AS category,\n  \n  TRY_CAST(price AS DECIMAL(10,2))\n AS price,\n  \n  TRY_CAST(created_at AS TIMESTAMP)\n AS created_at\nFROM \"jaffle_shop\".\"main\".\"raw_products\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_products\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.599837Z", "completed_at": "2024-11-05T18:51:29.608854Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.623646Z", "completed_at": "2024-11-05T18:51:29.719393Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.12945771217346191, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_inventory", "compiled": true, "compiled_code": "SELECT\n  CAST(product_id AS INTEGER) AS product_id,\n  CAST(quantity AS INTEGER) AS quantity,\n  CAST(last_updated AS TIMESTAMP) AS last_updated\nFROM \"jaffle_shop\".\"main\".\"raw_inventory\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_inventory\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.603273Z", "completed_at": "2024-11-05T18:51:29.609405Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.628131Z", "completed_at": "2024-11-05T18:51:29.719847Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 0.1291210651397705, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_orders", "compiled": true, "compiled_code": "SELECT\n  \n  TRY_CAST(order_id AS INTEGER)\n AS order_id,\n  \n  TRY_CAST(customer_id AS INTEGER)\n AS customer_id,\n  \n  TRY_CAST(order_date AS TIMESTAMP)\n AS order_date,\n  \n  TRY_CAST(total_amount AS DECIMAL(10,2))\n AS total_amount\nFROM \"jaffle_shop\".\"main\".\"raw_orders\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_orders\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.606462Z", "completed_at": "2024-11-05T18:51:29.609788Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.649482Z", "completed_at": "2024-11-05T18:51:29.720281Z"}], "thread_id": "Thread-7 (worker)", "execution_time": 0.1287839412689209, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_supplier_products", "compiled": true, "compiled_code": "SELECT\n  CAST(supplier_id AS INTEGER) AS supplier_id,\n  CAST(product_id AS INTEGER) AS product_id\nFROM \"jaffle_shop\".\"main\".\"raw_supplier_products\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_supplier_products\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.607550Z", "completed_at": "2024-11-05T18:51:29.621306Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.650979Z", "completed_at": "2024-11-05T18:51:29.720950Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 0.13204097747802734, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.stg_suppliers", "compiled": true, "compiled_code": "SELECT\n  CAST(supplier_id AS INTEGER) AS supplier_id,\n  CONCAT(UPPER(SUBSTRING(TRIM(supplier_name), 1, 1)), LOWER(SUBSTRING(TRIM(supplier_name), 2))) AS supplier_name,\n  LOWER(TRIM(contact_email)) AS contact_email,\n  TRIM(phone_number) AS phone_number\nFROM \"jaffle_shop\".\"main\".\"raw_suppliers\"", "relation_name": "\"jaffle_shop\".\"main\".\"stg_suppliers\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.734057Z", "completed_at": "2024-11-05T18:51:29.738930Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.748020Z", "completed_at": "2024-11-05T18:51:29.784663Z"}], "thread_id": "Thread-11 (worker)", "execution_time": 0.05347895622253418, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.dim_products", "compiled": true, "compiled_code": "SELECT\n  customer_id,\n  first_name,\n  last_name,\n  email,\n  created_at AS customer_created_date\nFROM \"jaffle_shop\".\"main\".\"stg_customers\"", "relation_name": "\"jaffle_shop\".\"main\".\"dim_products\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.736048Z", "completed_at": "2024-11-05T18:51:29.747830Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.749811Z", "completed_at": "2024-11-05T18:51:29.786192Z"}], "thread_id": "Thread-13 (worker)", "execution_time": 0.055684804916381836, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.low_stock", "compiled": true, "compiled_code": "WITH dim_products AS (\n    SELECT\n      product_id,\n      product_name,\n      category,\n      price,\n      created_at AS product_created_date\n    FROM \"jaffle_shop\".\"main\".\"stg_products\"\n),\n\ninventory_status AS (\n    SELECT\n      i.product_id,\n      p.product_name,\n      i.quantity,\n      i.last_updated\n    FROM \"jaffle_shop\".\"main\".\"stg_inventory\" AS i\n    JOIN \"jaffle_shop\".\"main\".\"stg_products\" AS p ON i.product_id = p.product_id\n),\n\ncurrent_inventory AS (\n    SELECT\n        i.product_id,\n        p.product_name,\n        p.category,\n        i.quantity,\n        i.last_updated\n    FROM inventory_status AS i\n    JOIN dim_products AS p ON i.product_id = p.product_id\n),\n\nlow_stock_products AS (\n    SELECT\n        ci.product_id,\n        ci.product_name,\n        ci.category,\n        ci.quantity,\n        ci.last_updated\n    FROM current_inventory AS ci\n    WHERE ci.quantity < 20\n)\n\nSELECT * FROM low_stock_products\nORDER BY quantity ASC", "relation_name": "\"jaffle_shop\".\"main\".\"low_stock\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.737538Z", "completed_at": "2024-11-05T18:51:29.749597Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.751558Z", "completed_at": "2024-11-05T18:51:29.786661Z"}], "thread_id": "Thread-15 (worker)", "execution_time": 0.05536675453186035, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.fact_sales", "compiled": true, "compiled_code": "SELECT\n  od.order_id,\n  o.order_date,\n  od.product_id,\n  od.quantity,\n  od.unit_price,\n  od.line_total,\n  o.customer_id\nFROM \"jaffle_shop\".\"main\".\"stg_order_details\" AS od\nJOIN \"jaffle_shop\".\"main\".\"stg_orders\" AS o ON od.order_id = o.order_id", "relation_name": "\"jaffle_shop\".\"main\".\"fact_sales\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.732745Z", "completed_at": "2024-11-05T18:51:29.738782Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.739119Z", "completed_at": "2024-11-05T18:51:29.787350Z"}], "thread_id": "Thread-10 (worker)", "execution_time": 0.062474966049194336, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.dim_customers", "compiled": true, "compiled_code": "SELECT\n  customer_id,\n  first_name,\n  last_name,\n  email,\n  created_at AS customer_created_date\nFROM \"jaffle_shop\".\"main\".\"stg_customers\"", "relation_name": "\"jaffle_shop\".\"main\".\"dim_customers\""}, {"status": "error", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.796935Z", "completed_at": "2024-11-05T18:51:29.799685Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.802274Z", "completed_at": "2024-11-05T18:51:29.818766Z"}], "thread_id": "Thread-17 (worker)", "execution_time": 0.04360485076904297, "adapter_response": {}, "message": "Runtime Error in model top_category (models/top_category.sql)\n  Binder Error: Table \"dp\" does not have a column named \"product_id\"\n  LINE 29: ...: \"1.8.1\", \"profile_name\": \"jaffle_shop\", \"target_name\": \"dev\", \"node_id\": \"model.jaffle_shop.top_category\"} */\n  \n    \n      \n      \n  \n      create  table\n        \"jaffle_shop\".\"main\".\"top_category__dbt_tmp\"\n    \n      as (\n        WITH fact_sales AS (\n      SELECT\n          od.order_id,\n          o.order_date,\n          od.product_id,\n          od.quantity,\n          od.unit_price,\n          od.line_total,\n          o.customer_id\n      FROM \"jaffle_shop\".\"main\".\"stg_order_details\" AS od\n      JOIN \"jaffle_shop\".\"main\".\"stg_orders\" AS o ON od.order_id = o.order_id\n  ),\n  \n  category_sales AS (\n      SELECT\n          dp.category,\n          SUM(fs.line_total) AS total_category_sales\n      FROM fact_sales AS fs\n      JOIN \"jaffle_shop\".\"main\".\"dim_products\" AS dp ON fs.product_id = dp.product_id\n                                                     ^", "failures": null, "unique_id": "model.jaffle_shop.top_category", "compiled": true, "compiled_code": "WITH fact_sales AS (\n    SELECT\n        od.order_id,\n        o.order_date,\n        od.product_id,\n        od.quantity,\n        od.unit_price,\n        od.line_total,\n        o.customer_id\n    FROM \"jaffle_shop\".\"main\".\"stg_order_details\" AS od\n    JOIN \"jaffle_shop\".\"main\".\"stg_orders\" AS o ON od.order_id = o.order_id\n),\n\ncategory_sales AS (\n    SELECT\n        dp.category,\n        SUM(fs.line_total) AS total_category_sales\n    FROM fact_sales AS fs\n    JOIN \"jaffle_shop\".\"main\".\"dim_products\" AS dp ON fs.product_id = dp.product_id\n    GROUP BY dp.category\n),\n\ntop_category AS (\n    SELECT\n        cs.category,\n        cs.total_category_sales,\n        RANK() OVER (ORDER BY cs.total_category_sales DESC) AS category_rank\n    FROM category_sales AS cs\n)\n\nSELECT * FROM top_category", "relation_name": "\"jaffle_shop\".\"main\".\"top_category\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.803795Z", "completed_at": "2024-11-05T18:51:29.808167Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.808663Z", "completed_at": "2024-11-05T18:51:29.849252Z"}], "thread_id": "Thread-21 (worker)", "execution_time": 0.050975799560546875, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.avg_order_value", "compiled": true, "compiled_code": "WITH fact_sales AS (\n    SELECT\n      od.order_id,\n      o.order_date,\n      od.product_id,\n      od.quantity,\n      od.unit_price,\n      od.line_total,\n      o.customer_id\n    FROM \"jaffle_shop\".\"main\".\"stg_order_details\" AS od\n    JOIN \"jaffle_shop\".\"main\".\"stg_orders\" AS o ON od.order_id = o.order_id\n),\n\ncustomer_order_totals AS (\n    SELECT\n        customer_id,\n        COUNT(DISTINCT order_id) AS total_orders,\n        SUM(line_total) AS total_spent\n    FROM fact_sales\n    GROUP BY customer_id\n    HAVING COUNT(DISTINCT order_id) > 3\n),\n\naverage_order_value AS (\n    SELECT\n        cot.customer_id,\n        dc.first_name,\n        dc.last_name,\n        cot.total_orders,\n        cot.total_spent,\n        ROUND(cot.total_spent / cot.total_orders, 1) AS avg_order_value\n    FROM customer_order_totals AS cot\n    JOIN \"jaffle_shop\".\"main\".\"dim_customers\" AS dc ON cot.customer_id = dc.customer_id\n)\n\nSELECT * FROM average_order_value\nORDER BY avg_order_value DESC", "relation_name": "\"jaffle_shop\".\"main\".\"avg_order_value\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.800126Z", "completed_at": "2024-11-05T18:51:29.806581Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.806772Z", "completed_at": "2024-11-05T18:51:29.849760Z"}], "thread_id": "Thread-19 (worker)", "execution_time": 0.05145001411437988, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.monthly_sales_growth", "compiled": true, "compiled_code": "WITH fact_sales AS (\n    SELECT\n      od.order_id,\n      o.order_date,\n      od.product_id,\n      od.quantity,\n      od.unit_price,\n      od.line_total,\n      o.customer_id\n    FROM \"jaffle_shop\".\"main\".\"stg_order_details\" AS od\n    JOIN \"jaffle_shop\".\"main\".\"stg_orders\" AS o ON od.order_id = o.order_id\n),\n\nmonthly_sales AS (\n    SELECT\n        DATE_TRUNC('month', order_date) AS sales_month,\n        SUM(line_total) AS total_revenue,\n        SUM(quantity) AS total_quantity_sold\n    FROM \"jaffle_shop\".\"main\".\"fact_sales\"\n    GROUP BY sales_month\n),\n\nsales_growth AS (\n    SELECT\n        ms.sales_month,\n        ms.total_revenue,\n        ms.total_quantity_sold,\n        LAG(ms.total_revenue) OVER (ORDER BY ms.sales_month) AS previous_revenue,\n        LAG(ms.total_quantity_sold) OVER (ORDER BY ms.sales_month) AS previous_quantity\n    FROM monthly_sales AS ms\n),\n\ngrowth_calculations AS (\n    SELECT\n        sg.sales_month,\n        sg.total_revenue,\n        sg.total_quantity_sold,\n        ROUND(((sg.total_revenue - sg.previous_revenue) / sg.previous_revenue) * 100, 2) AS revenue_growth_percentage,\n        ROUND(((sg.total_quantity_sold - sg.previous_quantity) / sg.previous_quantity) * 100, 2) AS quantity_growth_percentage\n    FROM sales_growth AS sg\n    WHERE sg.previous_revenue IS NOT NULL\n)\n\nSELECT * FROM growth_calculations\nORDER BY sales_month ASC", "relation_name": "\"jaffle_shop\".\"main\".\"monthly_sales_growth\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-11-05T18:51:29.805082Z", "completed_at": "2024-11-05T18:51:29.808501Z"}, {"name": "execute", "started_at": "2024-11-05T18:51:29.810422Z", "completed_at": "2024-11-05T18:51:29.850837Z"}], "thread_id": "Thread-22 (worker)", "execution_time": 0.05563235282897949, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.jaffle_shop.customer_LTV", "compiled": true, "compiled_code": "WITH fact_sales AS (\n    SELECT\n      od.order_id,\n      o.order_date,\n      od.product_id,\n      od.quantity,\n      od.unit_price,\n      od.line_total,\n      o.customer_id\n    FROM \"jaffle_shop\".\"main\".\"stg_order_details\" AS od\n    JOIN \"jaffle_shop\".\"main\".\"stg_orders\" AS o ON od.order_id = o.order_id\n),\n\ncustomer_revenue AS (\n    SELECT\n        fs.customer_id,\n        SUM(fs.line_total) AS total_revenue,\n        MIN(fs.order_date) AS first_purchase_date,\n        MAX(fs.order_date) AS last_purchase_date,\n        COUNT(DISTINCT fs.order_id) AS total_orders\n    FROM fact_sales AS fs\n    GROUP BY fs.customer_id\n),\n\ncustomer_ltv AS (\n    SELECT\n        cr.customer_id,\n        dc.first_name,\n        dc.last_name,\n        cr.total_revenue,\n        cr.total_orders,\n        DATE_PART('day', cr.last_purchase_date - cr.first_purchase_date) AS customer_lifespan_days,\n        ROUND(cr.total_revenue / NULLIF(cr.total_orders, 0), 2) AS avg_order_value,\n        ROUND(cr.total_revenue / NULLIF(DATE_PART('day', CURRENT_DATE - cr.first_purchase_date) / 30, 0), 2) AS monthly_ltv\n    FROM customer_revenue AS cr\n    JOIN \"jaffle_shop\".\"main\".\"dim_customers\" AS dc ON cr.customer_id = dc.customer_id\n)\n\nSELECT * FROM customer_ltv\nORDER BY total_revenue DESC", "relation_name": "\"jaffle_shop\".\"main\".\"customer_LTV\""}], "elapsed_time": 0.35483598709106445, "args": {"exclude": [], "send_anonymous_usage_stats": true, "select": [], "cache_selected_only": false, "vars": {}, "populate_cache": true, "require_resource_names_without_spaces": false, "partial_parse": true, "printer_width": 80, "source_freshness_run_project_hooks": false, "which": "run", "defer": false, "partial_parse_file_diff": true, "invocation_command": "dbt run", "log_format_file": "debug", "empty": false, "project_dir": "/Users/bunjee/Desktop/assignment4_db", "version_check": true, "print": true, "profiles_dir": "/Users/bunjee/Desktop/assignment4_db", "macro_debugging": false, "show_resource_report": false, "warn_error_options": {"include": [], "exclude": []}, "log_level_file": "debug", "use_colors_file": true, "use_colors": true, "write_json": true, "introspect": true, "quiet": false, "log_path": "/Users/bunjee/Desktop/assignment4_db/logs", "enable_legacy_logger": false, "favor_state": false, "require_explicit_package_overrides_for_builtin_materializations": true, "log_level": "info", "log_file_max_bytes": 10485760, "log_format": "default", "static_parser": true, "strict_mode": false, "indirect_selection": "eager"}}